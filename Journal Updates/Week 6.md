Before break, we had written code for linearizing and stabilizing our IR sensor readings, but we were still having trouble with readings when there was nothing in front of the IR sensor. Although the sensor was accurate out to 80 cm when there was an object in front of the sensor, we would get readings between 36-50 cm when no object was present, therefore, giving us a max usable distance of 36 cm, which was unfortunate but workable. Over break, however, Jonathan tried out a time-of-flight (distance) sensor (VL53L0X) which has a range of 5-120 cm. It’s smaller, has a much more focused field of view, the readings are more consistent, and it doesn’t have a problem when there are no objects in front of it. It doesn’t seem to update quite as fast as an IR sensor, but is still fast enough for our purposes. It also helps the readings if the sensor is tilted upward away from the ground just a little bit. The time-of-flight sensor is about the same price as a Sharp IR sensor ($14.95 at Adafruit).   

We were having trouble with the robot going out of bounds at certain angles before it had a chance to detect the white tape, so we started experimenting with using two color sensors (one on the right and one on the left). It turns out that the TCS34725 color sensor has a fixed I2C address and the Arduino Mega only has one set of SDA/SCL lines, so using multiple color sensors would create an I2C address conflict. We considered using a I2C multiplexer breakout, but then found a software workaround that allows any pair of digital pins to be used as separate SDA/SCL lines. So far this seems to have fixed the out of bounds issue and it has also allowed us to move the castor ball further forward, helping with the robot’s overall weight distribution.

There has been some talk about the TCS34725 being slow (the example code has it running once every 700 ms), but it is possible to run the sensor much faster. By shortening the integration time of the sensor and increasing its gain, the sensor can take readings much more quickly, albeit, less accurately. When you declare an object of class “Adafruit_TCS34725”, its user defined parameters include integration time and gain. If you look in the header “Adafruit_TCS34725.h”, which is one of the files included in the color sensor’s Arduino library, you’ll see several options for integration time and gain, as well as the limitations of each one. Our robot is currently using an integration time of 50 ms, which seems to be working just fine so far, but we will experiment with slightly longer times in the future if we end up requiring higher accuracy.

Another challenge our team was facing before break was getting all of our servos to operate properly. Along with the continuous rotation servos that we are using as wheel motors, we have two servos controlling the opening/closing motion of the claws for grabbing/releasing colored blocks, and another servo for panning the PixyCam and distance sensor to scan for and track colored blocks. While the continuous servos are rated for up to 7.4V (which is the voltage of our LiPo battery), our other servos are only rated up to 6V. Running these servos off of the Arduino’s regulated 5V wouldn’t be a problem, except that the servos draw too much current, especially when they first start moving. This led us to try out a dedicated servo driver (Adafruit 16-channel PCA9685) with a separate 5V power supply (4 AA batteries). Not only has this completely solved our servo troubles, but the servo driver also has a nice Arduino library.

One last improvement we’ve made to our code is removing most ‘delay’ commands. This is especially important for making the PID function smoothly. We’re currently using PID to track and steer toward colored blocks. Since delays increase the total time it takes to run the code, they make running PID difficult as PID needs to be updated continuously with minimal delay. As an alternative to using delays, we are using timing to control things such as our servos and LEDs. This has smoothed out our PID drastically. Here are a couple of home videos showing the PID, servo driver and time-of-flight sensor in action:

https://drive.google.com/open?id=1Ethq_C2Mjg_8b9d94fVlaLw9RRa1x1Wo

https://drive.google.com/open?id=1TqBCJK831qpO846vK_rY7-bPg2jnNUYS
